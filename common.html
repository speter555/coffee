<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Általános</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="common" class="article">
<div id="header">
<h1>Általános</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Minden cég kifejleszt valami saját keretrendszert amely a projekteket próbálja összefogni, ne kelljen ugyanolyan modulokat újra megírni, másolni, karbantartani.</p>
</div>
<div class="paragraph">
<p>Ez a keretrendszer alkalmas mind a SOA, mind a Microservice architektúra kiszolgálására. A felépítése moduláris, és felülírható projekt szinten szinte minden. A keretrendszer az alábbi rendszereken alapul, amelyek meghatározóak az egész működésre:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JAVA EE 8+</p>
</li>
<li>
<p>Java 11+</p>
</li>
<li>
<p>CDI 2.0+</p>
</li>
<li>
<p>Apache deltaspike 1.9+</p>
</li>
<li>
<p>Jboss logging</p>
</li>
<li>
<p>gson</p>
</li>
<li>
<p>guava</p>
</li>
<li>
<p>commons-lang3</p>
</li>
<li>
<p>apache http</p>
</li>
<li>
<p>resteasy</p>
</li>
<li>
<p>microprofile.io 1.3+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common_architecture">Architektúra felépítés</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/diag-31f9eff3ceaf2ac90d7b82dc09fb3c08.png" alt="diag 31f9eff3ceaf2ac90d7b82dc09fb3c08" width="820" height="1036">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common_coffee-core">Coffee Core</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="common_core_coffee-se">coffee-se</h3>
<div class="paragraph">
<p>Modul célja a lehetőség szerint java EE API-tól független osztályok gyűjtése.</p>
</div>
<div class="sect3">
<h4 id="common_core_coffee-se_coffee-se-logging">coffee-se-logging</h4>
<div class="paragraph">
<p>Loggolással és MDC-vel kapcsolatos JavaEE függőséget nem tartalmazó komponensek modulja.</p>
</div>
<div class="sect4">
<h5 id="_loggolás">Loggolás</h5>
<div class="paragraph">
<p>Tartalmaz egy <code>java.util.logging.Logger</code>-t használó alap loggolási rendszert.</p>
</div>
<div class="listingblock">
<div class="title">Minta használat SE környezetben</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.se.logging.Logger</span>;

<span class="directive">private</span> <span class="predefined-type">Logger</span> log = <span class="predefined-type">Logger</span>.getLogger(BlaBla.class);

<span class="directive">public</span> <span class="predefined-type">String</span> blabla() {
    log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">blabla log message</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">blabla</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bővebb leírás és CDI-on keresztüli használat a <a href="#common_core_coffee-cdi_logger">coffee-cdi/logger</a> részen olvasható.</p>
</div>
</div>
<div class="sect4">
<h5 id="common_core_coffee-se_coffee-se-logging_MDC">MDC</h5>
<div class="paragraph">
<p>A modul saját keretrendszer-t tartalmaz az MDC (Mapped Diagnostic Context) kezelésre.
Ennek oka, hogy adott projekteken eltérő MDC megoldások lehetnek (pl. jboss, slf4j, logback&#8230;&#8203;).
Használata a <code>hu.icellmobilsoft.coffee.se.logging.mdc.MDC</code> osztály static metódusain keresztül történik.</p>
</div>
<div class="paragraph">
<p>Az MDC osztály belül megpróbál a classpath-on elérhető MDC megoldást keresni, és a talált osztálynak delegálni a kéréseket.
Jelenleg a <code>org.jboss.logging.MDC</code> és a <code>org.slf4j.MDC</code> implementációk támogatottak,
azonban a modul service loader segítségével projekt szinten kiterjeszthető.</p>
</div>
<div class="sect5">
<h6 id="_mdc_kiterjesztése">MDC kiterjesztése</h6>
<div class="paragraph">
<p>Coffee szinten nem támogatott MDC implementáció használatához az <code>MDCAdapter</code> és <code>MDCAdapterProvider</code>
interface-eket szükséges implementálni, majd service loader mechanizmussal betölteni az implementált <code>MDCAdapterProvider</code>-t.</p>
</div>
<div class="sect6">
<h7 id="_példa_custommdc_bekötése">Példa <code>CustomMDC</code> bekötése:</h7>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>MDCAdapter</code> implementálása <code>CustomMDC</code>-hez:</p>
<div class="listingblock">
<div class="title">com.project.CustomMDCAdapter</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomMDCAdapter</span> <span class="directive">implements</span> MDCAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> get(<span class="predefined-type">String</span> key){
        <span class="comment">//The adapter delegates its calls to our CustomMdc</span>
        <span class="keyword">return</span> CustomMDC.get(key);
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>MDCAdapterProvider</code> implementálása <code>CustomMDCAdapter</code> legyártásához:</p>
<div class="listingblock">
<div class="title">com.project.CustomMDCAdapterProvider</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomMDCAdapterProvider</span> <span class="directive">implements</span> MDCAdapterProvider {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> MDCAdapter getAdapter() <span class="directive">throws</span> <span class="exception">Exception</span>;{
        <span class="keyword">return</span> <span class="keyword">new</span> CustomMDCAdapter();
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>CustomMDCAdapterProvider</code> bekötése service loaderen keresztül:</p>
<div class="listingblock">
<div class="title">META-INF/services/hu.icellmobilsoft.coffee.se.logging.mdc.MDCAdapterProvider</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">com.project.CustomMDCAdapterProvider</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mdc_sorrend">MDC sorrend</h6>
<div class="paragraph">
<p>Az elérhető MDC implementációkat az alábbi sorrendben próbálja felolvasni.
A belül használt MDC az első működő lesz:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ServiceLoader kiterjesztések</p>
</li>
<li>
<p><code>org.jboss.logging.MDC</code></p>
</li>
<li>
<p><code>org.slf4j.MDC</code></p>
</li>
<li>
<p><code>CoffeeMDCAdapter</code></p>
<div class="ulist">
<ul>
<li>
<p>coff:ee implementáció, csak fallback-nek van</p>
</li>
<li>
<p>az értékeket <code>ThreadLocal</code>-ban tárolja</p>
</li>
<li>
<p>külön le kell kezelni, ha szeretnénk, hogy loggolva legyen.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_core_coffee-cdi">coffee-dto</h3>
<div class="paragraph">
<p>Modul célja hogy összefoglalja az alap DTO, adapterek és Exception osztályok őseit,
főleg azért hogy egyátalán lehessen valami közos kódokat kiemelni a Coffee frameworkbe.
Lehetelőg semmilyen függősége (dependency) nem lehet,
kivéve a dokumentációt és JAXB funkciókat kiszolgáló annotációk.</p>
</div>
<div class="paragraph">
<p>Több almodulból ál.</p>
</div>
<div class="sect3">
<h4 id="_coffee_dto_base">coffee-dto-base</h4>
<div class="paragraph">
<p>Tartalma olyan java osztályok melyek ősként szolgálnak az egész Coffee framework-ben.</p>
</div>
<div class="paragraph">
<p>Itt táláható a java.time (java 8+) XSD univerzális adapterek is.</p>
</div>
<div class="paragraph">
<p>A modul az alap exception classokat tartalmazza.
Minden más exception amit létrehozunk,
csak ezekből származhat.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coffee_dto_xsd">coffee-dto-xsd</h4>
<div class="paragraph">
<p>Tartalma lehetőleg XSD-k, melyek útmutatóként szolgálnak a projekteken.
Lehetőleg nagyon univerzális XSD simple és complexType-okat tartalmaznak,
melyeket a projektek saját képére tudják hajlítani.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Ez a modul nem generál DTO obektumokat, csak az XSD-ket adja hozzá.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_coffee_dto_gen">coffee-dto-gen</h4>
<div class="paragraph">
<p>A modul az Coffee DTO generálására szolgál.
Direkt külön van szervezve hogy a dependency struktúrából könnyen helyettesíthető legyen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coffee_dto_impl">coffee-dto-impl</h4>
<div class="paragraph">
<p>A modul minta implementációként szolgál a <code>coffee-dto-base</code>, <code>coffee-dto-xsd</code> és <code>coffee-dto-gen</code>-hez.
A Coffee-t használó projektek ezt fogják bekötni.
Hogyha a cél projektnek nem felel meg a Coffee által generált DTO-k akkor ennél a modulnál kell excelude-olni.</p>
</div>
<div class="paragraph">
<p>Önmagában egy univerzális, használható modul.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_core_coffee-cdi">coffee-cdi</h3>
<div class="paragraph">
<p>Modul célja a java EE, logger, deltaspike és microprofile-config bekötése.</p>
</div>
<div class="paragraph">
<p>Minden CDI alapon működik. Alábbi komponensek leírása és használati esetek:</p>
</div>
<div class="sect3">
<h4 id="common_core_coffee-cdi_logger">Logger</h4>
<div class="paragraph">
<p>A Coffee saját loggolási rendszert használ, több okból fogva:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>csomagolja a valódi loggolási rendszert (jelenleg ez java util log)</p>
</li>
<li>
<p>request szinten gyüjti össze az összes logot ami loggolódik a rendszerben,
azt is amit nem iratunk ki a konzolba (vagy máshova) mert magasabb szintre van állítva a loggolás
(például ha INFO szintre van állítva a root logger, akkor a TRACE, DEBUG szintű log nem kerül ki sehova).
Ezeket a logokat hiba esetén képesek vagyunk kiloggolni, hogy segíteni tudjuk a hibakeresés folyamát</p>
</li>
<li>
<p>egyéb információkat lehet rakni a log request szintű containerébe</p>
</li>
<li>
<p>ellenőrizni hogy milyen szintű log level a legmagasabb ami loggolásra került</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Minden osztálynak saját loggere van, a loggerek nem örökölhetőek, nem átadhatóak. Az alapját a CDI + jboss logger biztosítja, használata:</p>
</div>
<div class="listingblock">
<div class="title">Minta használat</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// <b class="conum">(1)</b>
<span class="annotation">@Inject</span>
<span class="annotation">@ThisLogger</span>
<span class="directive">private</span> hu.icellmobilsoft.coffee.cdi.logger.AppLogger log;


// <b class="conum">(2)</b>
<span class="annotation">@Inject</span>
<span class="directive">private</span> hu.icellmobilsoft.coffee.se.logging.Logger log;

// <b class="conum">(3)</b>
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.logger.LogProducer</span>;

<span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> blabla() {
    LogProducer.getStaticDefaultLogger(BlaBla.class).trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">class blabla</span><span class="delimiter">&quot;</span></span>);
    LogProducer.getStaticDefaultLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">BlaBla</span><span class="delimiter">&quot;</span></span>).trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">class name blabla</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">blabla</span><span class="delimiter">&quot;</span></span>;
}

// <b class="conum">(4)</b>
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.se.logging.Logger</span>;

<span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> blabla() {
    <span class="predefined-type">Logger</span>.getLogger(BlaBla.class).trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">class blabla</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">BlaBla</span><span class="delimiter">&quot;</span></span>).trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">class name blabla</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">blabla</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>ahol @RequestScope-ban (vagy magasabb scope-ban) dolgozunk az osztályal (esetek 90%)</p>
</li>
<li>
<p>ahol nincs RequestScope</p>
</li>
<li>
<p>ahol nem használható az inject, pl. static metódusokban</p>
</li>
<li>
<p>JavaSE környezetben pl. cliens jar-ok</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ha a loggolásban szerepel paraméter, akkor azt KIVÉTEL NÉLKÜL "[paraméter]" jelek közé kell rakni.</p>
</div>
<div class="listingblock">
<div class="title">Paraméter loggolása minta</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Generált azonosító: [{0}]</span><span class="delimiter">&quot;</span></span>, id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ennek a célja, hogy a log nézegetésnél egyből azonosítani lehet a változó értéket, valamit azt is, ha az "" (üres String) vagy null értéke van.</p>
</div>
</div>
<div class="sect3">
<h4 id="common_core_coffee-cdi_logger">Config</h4>
<div class="paragraph">
<p>Konfiguráció megoldásként a microprofile-config megoldásait használjuk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
microprofile.io<br>
<a href="https://github.com/eclipse/microprofile-config" class="bare">https://github.com/eclipse/microprofile-config</a><br>
<a href="http://mirrors.ibiblio.org/eclipse/microprofile/microprofile-config-1.3/microprofile-config-spec.pdf" class="bare">http://mirrors.ibiblio.org/eclipse/microprofile/microprofile-config-1.3/microprofile-config-spec.pdf</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Röviden összefoglalva hogy mi is ez? A konfigurációs paraméterek megadása széles körben történhet. Nem elég egy konfigurációs paramétert beégetni valami properties fájlba, mert környezetenként annak más értéke lehet. Az értékek külön szinten megadhatók, legyen az ETCD, properties, system property, environment property vagy akármi más. A microprofile-config képes egy megadott kulcsot kikeresni az összes elérhetó forrásból és a legmagasabb prioritású értéket használja fel. Alap használati esetek:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kódban - amikor nem használható a CDI container, statikus metódusok és egyéb esetek</p>
</li>
<li>
<p>statikus - a program felfutásánál minden</p>
</li>
<li>
<p>dinamikus - a kulcs érték keresése dinamikusan történik, minden egyes felhasználásnál. Konfiguráció változás újraindítás nélkül történhet (például futás közben beállítunk valami system property-t)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Konfiguráció minta</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.inject.ConfigProperty</span>;
<span class="keyword">import</span> <span class="include">org.eclipse.microprofile.config.ConfigProvider</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Provider</span>;


// <b class="conum">(1)</b>
<span class="directive">public</span> <span class="predefined-type">String</span> kodban() {
    Config config = ConfigProvider.getConfig();
    <span class="predefined-type">String</span> keyValue =  config.getValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
    <span class="keyword">return</span> keyValue;
}


// <b class="conum">(2)</b>
<span class="annotation">@Inject</span>
<span class="annotation">@ConfigProperty</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> keyValue;

<span class="directive">public</span> <span class="predefined-type">String</span> statikusan() {
    <span class="keyword">return</span> keyValue;
}


// <b class="conum">(3)</b>
<span class="annotation">@Inject</span>
<span class="annotation">@ConfigProperty</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Provider</span>&lt;<span class="predefined-type">String</span>&gt; keyValue;

<span class="directive">public</span> <span class="predefined-type">String</span> dinamikusan() {
    <span class="keyword">return</span> keyValue.get();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>kódban lekérdezett érték</p>
</li>
<li>
<p>statikus érték beallítás</p>
</li>
<li>
<p>dinamikus érték lekérdezés</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_core_coffee-tool">coffee-tool</h3>
<div class="paragraph">
<p>Modul célja az alap util osztályok gyűjtése.</p>
</div>
<div class="paragraph">
<p>Minden dátum, String, Number vagy egyéb statikus osztályoknak itt a helye.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MavenURLHandler</code></dt>
<dd>
<p>Az XSD Catalog használatra szolgáló segédosztály, lehetővé teszi a</p>
<div class="literalblock">
<div class="content">
<pre>maven:hu.icellmobilsoft.coffee.dto.xsd:coffee-dto-xsd:jar::!/xsd/hu/icellmobilsoft/coffee/dto/common/common.xsd</pre>
</div>
</div>
<div class="paragraph">
<p>URL kezelését a kódban.
Külön aktiválni kell, tehát nem okoz komplikációt (de aktiválva sem).</p>
</div>
</dd>
<dt class="hdlist1"><code>AesGcmUtil</code></dt>
<dd>
<p>AES 256 GCM encryptálásra és decryptálásra segédosztály. A cipher <code>AES/GCM/NoPadding</code> alapján történik, a kulcsnak 256 bit hosszúnak kell lennie, az IV 12 byte hosszú. Tartalmaz segéd metódusokat kulcs és IV generáláshoz is.</p>
<div class="paragraph">
<p>Példa használat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> inputText = <span class="string"><span class="delimiter">&quot;</span><span class="content">test input test</span><span class="delimiter">&quot;</span></span>;
<span class="type">byte</span><span class="type">[]</span> key = AesGcmUtil.generateKey(); <span class="comment">//B64: HMTpQ4/aEDKoPGMMqMtjeTJ2s26eOEv1aUrE+syjcB8=</span>
<span class="type">byte</span><span class="type">[]</span> iv = AesGcmUtil.generateIv(); <span class="comment">//B64: 5nqOVSjoGYk/oSwj</span>

<span class="type">byte</span><span class="type">[]</span> encoded = AesGcmUtil.encryptWithAes256GcmNoPadding(key, inputText.getBytes(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>), iv);
<span class="predefined-type">String</span> encodedB64 = Base64.getEncoder().encodeToString(encoded); <span class="comment">//fRCURHp5DWXtrESNHMo1DUoAcejvKDu9Y5wd5zXblg==</span>

<span class="type">byte</span><span class="type">[]</span> decoded = AesGcmUtil.decryptWithAes256GcmNoPadding(key, encoded, iv);
<span class="predefined-type">String</span> decodedString = <span class="keyword">new</span> <span class="predefined-type">String</span>(decoded, <span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>); <span class="comment">//test input test</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Adott kulcs-IV párt nem szabad újra használni! Emiatt az IV nélküli encrypt/decrypt-et csak egyszer használatos kulcsokkal szabad meghívni!
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="common_core_coffee-jpa">coffee-jpa</h3>
<div class="paragraph">
<p>Modul célja a JPA bekötése.</p>
</div>
<div class="paragraph">
<p>Tartalmazza a deltaspike jpa és a hibernate bekötését. Itt találhatók a lapozás segítő osztályok, tranzakció kezelési osztályok, és minden *Service őse, a BaseService osztály.</p>
</div>
</div>
<div class="sect2">
<h3 id="common_core_coffee-rest">coffee-rest</h3>
<div class="paragraph">
<p>Modul célja a REST kommunikáció és a kezelése.</p>
</div>
<div class="paragraph">
<p>Tartalmazza az apache http klienst, különböző REST loggereket és filtereket. Továbbá a nyelvesítés, REST aktivátor és Response util osztály is itt található.</p>
</div>
<div class="sect3">
<h4 id="_baserestlogger">BaseRestLogger</h4>
<div class="paragraph">
<p>Az osztály célja, hogy loggolja az alkalmazásba érkező HTTP request-response kéréseket.
Aktiválása kézzel történik, projekt szinten a következő minta alapján:</p>
</div>
<div class="listingblock">
<div class="title">Projektben aktiválás</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">hu.icellmobilsoft.project.common.rest.logger</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.ws.rs.ext.Provider</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.logger.AppLogger</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.logger.ThisLogger</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.rest.log.BaseRestLogger</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.rest.log.LogConstants</span>;

<span class="annotation">@Provider</span> // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RestLogger</span> <span class="directive">extends</span> BaseRestLogger {

    <span class="annotation">@Inject</span>
    <span class="annotation">@ThisLogger</span>
    <span class="directive">private</span> AppLogger log;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> sessionKey() { // <b class="conum">(2)</b>
        <span class="keyword">return</span> LogConstants.LOG_SESSION_ID;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>JAX-RS aktivátor (ez a lényeg ami aktiválja)</p>
</li>
<li>
<p>HTTP headerben szereplő session azonosító kulcs neve</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Maga a HTTP request-response log összeállításáról a <code>hu.icellmobilsoft.coffee.rest.log.RequestResponseLogger</code> osztály gondoskodik, és ha igény van rá ezt lehet felhasználni más helyzetekben is, például hiba esetén loggolásnál.</p>
</div>
<div class="paragraph">
<p>A request loggolása során az érzékeny adatok mind a header-ek közül, mind a json/xml body-ból maszkolásra kerülnek (pl. <code>X-PASSWORD: 1234</code> helyett <code>X_PASSWORD: *</code>).
Az adatokról a kulcsuk (header és JSON tartolmnál a kulcs, XML-nél a tag) alapján kerül megállapításra, hogy védendőek-e; ezek alapértelmezetten a <code>[\w\s]*?secret[\w\s]*?</code> vagy <code>[\w\s]*?pass[\w\s]*?</code> regexek-nek megfelelő kulcsok (pl. userPassword, secretToken, &#8230;&#8203;),
amennyiben a projekten szükséges, úgy a regex felülírható ha valamelyik <strong>alapértelmezett</strong> microprofile-config forrásban (sys var, env var, META-INF/microprofile-config.properties) megadjuk a <code>coffee.config.log.sensitive.key.pattern</code> konfigot, több pattern is megadható vesszővel elválasztva.</p>
</div>
<div class="listingblock">
<div class="title">Példa request log</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2019-02-01 16:31:33.044 INFO  [thread:default task-1] [hu.icellmobilsoft.coffee.rest.log.BaseRestLogger] [sid:2G7XOSOJBCFRMW08] - * Server in-bound request
&gt; POST http://localhost:8083/external/public/sampleService/sample/interface
&gt; -- Path parameters:
&gt; -- Query parameters:
&gt; -- Header parameters:
&gt; accept: text/xml;charset=utf-8
&gt; Connection: keep-alive
&gt; Content-Length: 106420
&gt; content-type: text/xml;charset=utf-8
&gt; Host: localhost:8083
&gt; User-Agent: Apache-HttpClient/4.5.3 (Java/1.8.0_191)
&gt; X-Client-Address: 10.10.20.49
&gt; X-CustomerNumber: 10098990
&gt; X-Password: *
&gt; X-UserName: sample
&gt;
&gt; entity: [&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SampleRequest xmlns=&quot;http://schemas.nav.gov.hu/OSA/1.0/api&quot;&gt;
    &lt;header&gt;
        &lt;requestId&gt;RID314802331803&lt;/requestId&gt;
        &lt;timestamp&gt;2019-02-01T15:31:32.432Z&lt;/timestamp&gt;
        &lt;requestVersion&gt;1.1&lt;/requestVersion&gt;
        &lt;headerVersion&gt;1.0&lt;/headerVersion&gt;
    &lt;/header&gt;
    &lt;user&gt;
        &lt;passwordHash&gt;*&lt;/passwordHash&gt;
... // röviditve</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Példa response log</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2019-02-01 16:31:34.042 INFO  [thread:default task-1] [hu.icellmobilsoft.coffee.rest.log.BaseRestLogger] [sid:2G7XOSOJBCFRMW08] - &lt; Server response from [http://localhost:8083/external/public/sampleService/sample/interface]:
&lt; Status: [200], [OK]
&lt; Media type: [text/xml;charset=UTF-8]
&lt; -- Header parameters:
&lt; Content-Type: [text/xml;charset=UTF-8]
&lt; entity: [{&quot;transactionId&quot;:&quot;2G7XOSYJ6VUEJJ09&quot;,&quot;header&quot;:{&quot;requestId&quot;:&quot;RID314802331803&quot;,&quot;timestamp&quot;:&quot;2019-02-01T15:31:32.432Z&quot;,&quot;requestVersion&quot;:&quot;1.1&quot;,&quot;headerVersion&quot;:&quot;1.0&quot;},&quot;result&quot;:{&quot;funcCode&quot;:&quot;OK&quot;},&quot;software&quot;:{&quot;softwareId&quot;:&quot;123456789123456789&quot;,&quot;softwareName&quot;:&quot;string&quot;,&quot;softwareOperation&quot;:&quot;LOCAL_SOFTWARE&quot;,&quot;softwareMainVersion&quot;:&quot;string&quot;,&quot;softwareDevName&quot;:&quot;string&quot;,&quot;softwareDevContact&quot;:&quot;string&quot;,&quot;softwareCountryCode&quot;:&quot;HU&quot;,&quot;softwareDescription&quot;:&quot;string&quot;}]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="common_core_coffee-rest_LogSpecifier">LogSpecifier</h4>
<div class="paragraph">
<p>A REST logolás végpontonként testreszabható a <code>hu.icellmobilsoft.coffee.rest.log.annotation.LogSpecifier</code> annotációval,
ez egy helyen többször is megadható, valamint a scope-ja korlátozható a <code>target</code> mezőjével,
amiből több is megadható az annotációban (alapértelmezetten minden target-ra aktiválódik);
így megvan a lehetőség, hogy a REST request-response, microprofile-client request-response-okat külön-külön testreszabjuk.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Egy végponton <code>LogSpecifierTarget</code>-enként csak egy LogSpecifier szerepelhet.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Megadható <code>target</code>-ek, a <code>hu.icellmobilsoft.coffee.rest.log.annotation.enumeration.LogSpecifierTarget</code> enum értékei:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">LogSpecifierTarget</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REQUEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST végpont request-je</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESPONSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST végpont response-a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_REQUEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microprofile REST Client végpont request-je</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLIENT_RESPONSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microprofile REST Client végpont response-a</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Jelenleg a LogSpecifier a következő esetekre van felkészítve:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a végponton a request-response logolása kikapcsolható a <code>LogSpecifier</code> annotáció <code>noLog</code> kapcsolójával.</p>
</li>
<li>
<p>a végponton a kilogolt body méretét a <code>LogSpecifier</code> annotáció <code>maxEntityLogSize</code> mezőjével lehet korlátozni.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
ha a <code>maxEntityLogSize</code> <code>LogSpecifier.NO_LOG</code>-tól <strong>eltérő</strong> értékre van állítva, akkor a REST endpoint-hoz érkező <code>application/octet-stream</code> mediaType esetében csak a kérés első 5000 karaktere íródik ki.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">LogSpecifier példa</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@POST</span>
    <span class="annotation">@Produces</span>({ MediaType.APPLICATION_JSON, MediaType.TEXT_XML, MediaType.APPLICATION_XML })
    <span class="annotation">@Consumes</span>({ MediaType.APPLICATION_JSON, MediaType.TEXT_XML, MediaType.APPLICATION_XML })
    <span class="annotation">@LogSpecifier</span>(target={LogSpecifierTarget.REQUEST, LogSpecifierTarget.CLIENT_REQUEST}, maxEntityLogSize =  <span class="integer">100</span>) //<b class="conum">(1)</b>
    <span class="annotation">@LogSpecifier</span>(target=LogSpecifierTarget.RESPONSE, maxEntityLogSize =  <span class="integer">5000</span>) //<b class="conum">(2)</b>
    <span class="annotation">@LogSpecifier</span>(target=LogSpecifierTarget.CLIENT_RESPONSE, noLog =  <span class="predefined-constant">true</span>) //<b class="conum">(3)</b>
    WithoutLogResponse postWithoutLog(WithoutLogRequest withoutLogRequest) <span class="directive">throws</span> BaseException;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Request entity log méretét 100 byte-ra korlátozza, REST hívások és microprofile client használatánál is</p>
</li>
<li>
<p>Response entity log méretét 5000 karakterre korlátozza a REST hívásoknál</p>
</li>
<li>
<p>Kikapcsolja a response logolást microprofile rest client válaszoknál.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_logspecifiersannotationprocessor">LogSpecifiersAnnotationProcessor</h5>
<div class="paragraph">
<p>A <code>LogSpecifier</code>-hez tartozik a <code>hu.icellmobilsoft.coffee.rest.log.annotation.processing.LogSpecifiersAnnotationProcessor</code>,
ennek feladata, hogy a <code>LogSpecifier</code> többszöri definiálhatósága miatt ne lehessen ugyanarra a <code>target</code>-re több értéket is definiálni.
Ehhez fordítási időben ellenőrzi, hogy hány <code>@LogSpecifier</code> lett definiálva <code>LogSpecifierTarget</code>-enként, amennyiben többet talál úgy a fordítást buktatja.</p>
</div>
<div class="listingblock">
<div class="title">Invalid példa</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@POST</span>
    <span class="annotation">@Produces</span>({ MediaType.APPLICATION_JSON, MediaType.TEXT_XML, MediaType.APPLICATION_XML })
    <span class="annotation">@Consumes</span>({ MediaType.APPLICATION_JSON, MediaType.TEXT_XML, MediaType.APPLICATION_XML })
    <span class="annotation">@LogSpecifier</span>(maxEntityLogSize =  <span class="integer">100</span>) //<b class="conum">(1)</b>
    <span class="annotation">@LogSpecifier</span>(target = LogSpecifierTarget.RESPONSE, maxEntityLogSize =  <span class="integer">5000</span>) //<b class="conum">(2)</b>
    ValidatorResponse postValidatorTest(ValidatorRequest validatorRequest) <span class="directive">throws</span> BaseException;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mivel nincs megadva target, ezért minden entity log méretét 100 byte-ra/karakterre korlátozza, beleértve a <code>LogSpecifierTarget.RESPONSE</code>-ét is.</p>
</li>
<li>
<p><strong>LogSpecifierTarget.RESPONSE</strong> entity log méretét 5000 karakterre korlátozza.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Mivel fenti példában a REST response mérete az első annotáció miatt 100, a második annotáció miatt pedig 5000 kellene legyen, így elkerülendő a rejtett logikát a <code>LogSpecifiersAnnotationProcessor</code> el fogja buktatni a fordítást az alábbi error-ral:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="log">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.1:compile (default-compile) on project project-sample-service: Compilation failure
[ERROR] .../project-sample-service/src/main/java/hu/icellmobilsoft/project/sample/service/rest/ISampleTestRest.java:[43,23] Multiple LogSpecifiers are defined for the [RESPONSE] of [postValidatorTest]! Conflicting LogSpecifiers:[[@hu.icellmobilsoft.coffee.rest.log.annotation.LogSpecifier(noLog=false, maxEntityLogSize=100, target={REQUEST, RESPONSE, CLIENT_REQUEST, CLIENT_RESPONSE}), @hu.icellmobilsoft.coffee.rest.log.annotation.LogSpecifier(noLog=false, maxEntityLogSize=5000, target={RESPONSE})]]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="common_core_coffee-rest_JaxbTool">JaxbTool</h4>
<div class="paragraph">
<p>Az osztály célja hogy az XML objektummal kapcsolatos transzformációkat és kezeléseket foglalja össze.
A felépítése teljes mértékben moduláris, mindent projekt saját igényére tudja szabni a CDI segítségével.
A moduljai alapesetben ilyen működést biztosítanak:</p>
</div>
<div class="sect4">
<h5 id="_request_verzió_megállapítása">Request verzió megállapítása</h5>
<div class="paragraph">
<p>Ezt az <code><strong>IXmlRequestVersionReader</strong></code> interfész biztosítja.
Az implementáló beépített és cserélhető osztály: <code>hu.icellmobilsoft.coffee.rest.validation.xml.reader.XmlRequestVersionReader</code>.</p>
</div>
<div class="paragraph">
<p>Minta alapján a</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"> ...&lt;header&gt;...&lt;requestVersion&gt;1.1&lt;/requestVersion&gt;...&lt;/header&gt;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>XML struktúrából keresi, persze szabadon módosítható más struktúrára vagy akár HTTP header olvasásból.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xsd_hiba_gyűjtése">XSD hiba gyűjtése</h5>
<div class="paragraph">
<p>Marshal (DTO &#8594; XML String) vagy unmarshal (XML String/Stream &#8594; DTO) esetén kérhető a XSD szerinti ellenőrzés.
Ilyenkor <code>hu.icellmobilsoft.coffee.rest.validation.xml.exception.XsdProcessingException</code>
formában megkapjuk a XSD szabályokat sértő hibákat, listában.
Ezeket a hibákat a <code><strong>IXsdValidationErrorCollector</strong></code> interfész kezeli és biztosítja.</p>
</div>
<div class="paragraph">
<p>Az implementáló beépített és cserélhető osztály: <code>hu.icellmobilsoft.coffee.rest.validation.xml.error.XsdValidationErrorCollector</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xsd_schema_fájlok_kezelése">XSD (schema) fájlok kezelése</h5>
<div class="paragraph">
<p>Az XSD schema leíró fájlok kezelésére plusz logika szükséges, mivel azokban különféle összekötés lehetséges.
Ezzel a problémával a <code><strong>IXsdResourceResolver</strong></code> interfész foglalkozik.</p>
</div>
<div class="paragraph">
<p>Az implementáló beépített és cserélhető osztály: <code>hu.icellmobilsoft.coffee.rest.validation.xml.utils.XsdResourceResolver</code>.
Olyan alap probléma hogy az XSD-k egymást importálják egy közös könyvtárban múködik alapból is,
de az hogy tudjunk importáljni XSD-t egy másik projektből, arra már extra logika szükséges.
Ebben az osztályban ez a helyzet van lekezelve.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xsd_catalog_schema_kezelés">XSD Catalog schema kezelés</h4>
<div class="paragraph">
<p>A <a href="#howto_xsd_catalog">XSD Catalog és generálás</a> részben található leírás foglalkozik az XSD generálással.
Ez a felyezet a kódban lévő aktiválását veszi célba - XML validálása XSD catalog segítségével.</p>
</div>
<div class="paragraph">
<p>Egész funkciót a <a href="#common_core_coffee-rest_JaxbTool">JaxbTool</a> osztály végzi.
Szándékosan olyan modulárisan van felépítve hogy könnyen lehessen igényekhez hajlítani.
A fenti leírás alapján a Coffee tartalmaz egy <code><strong>IXsdResourceResolver</strong></code> implementációt,
ami fel tudja olvasni az XSD Catalog-ban megadott séma struktúrát.
Ez az osztály a</p>
</div>
<div class="listingblock">
<div class="title">hu.icellmobilsoft.coffee.rest.validation.catalog.PublicCatalogResolver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Alternative</span>
<span class="annotation">@Priority</span>(<span class="integer">100</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PublicCatalogResolver</span> <span class="directive">implements</span> LSResourceResolver, IXsdResourceResolver {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mivel az XSD Catalog generálásnál használunk maven által bekötött függőségeket, mint pl.:</p>
</div>
<div class="listingblock">
<div class="title">/xxx/super.catalog.xsd</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;public</span> <span class="attribute-name">publicId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://common.dto.coffee.icellmobilsoft.hu/common</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maven:hu.icellmobilsoft.coffee.dto.xsd:coffee-dto-xsd:jar::!/xsd/hu.icellmobilsoft.coffee/dto/common/common.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Így fel kell készülni a <code>maven:</code> URI protokolhoz kezelésére.
Ez el is készült a <code>hu.icellmobilsoft.coffee.tool.protocol.handler.MavenURLHandler</code> osztályban,
amit aktiválni kell.
Ez megtörténhet több féle képpen, ajánlott megoldás a következő:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/services/java.net.spi.URLStreamHandlerProvider</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">hu.icellmobilsoft.coffee.rest.validation.catalog.MavenURLStreamHandlerProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tehát létre kell hozni a <code>src/main/resources/META-INF/services/java.net.spi.URLStreamHandlerProvider</code> fájlt
és beleírni azt a class-t mely kezelésbe veszi (Coffee része).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Lehetnek olyan rendszerek (pl. Thorntail),
melyek nem képesek ezt a fájlt beolvasni időben az alkalmazás felfutása idejében.
Ilyenkor van még egy lehetőségünk a <code>URL.setURLStreamHandlerFactory(factory);</code> megoldáson keresztül.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_catalog_jaxbtool_aktiválása">Catalog JaxbTool aktiválása</h5>
<div class="paragraph">
<p>A <code>maven:</code> URI protokol kezelési beállítás után már csak 2 dolog van hátra:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PublicCatalogResolver</code> aktiválása</p>
</li>
<li>
<p>catalog fájl megadása</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>PublicCatalogResolver</code> aktiválása klasszikus CDI módon történik:</p>
</div>
<div class="listingblock">
<div class="title">beans.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/beans_1_1.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bean-discovery-mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;alternatives&gt;</span>
        <span class="tag">&lt;class&gt;</span>hu.icellmobilsoft.coffee.rest.validation.catalog.PublicCatalogResolver<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/alternatives&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A catalog xsd fájl megadása pedig a konfiguráción keresztül történik, pontosabban a</p>
</div>
<div class="literalblock">
<div class="content">
<pre>coffee.config.xml.catalog.path</pre>
</div>
</div>
<div class="paragraph">
<p>kulcs megdásával, íme egy példa:</p>
</div>
<div class="listingblock">
<div class="title">project-defaults.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">coffee</span>:
    <span class="key">config</span>:
        <span class="key">xml</span>:
            <span class="key">catalog</span>:
                <span class="key">path</span>: <span class="string"><span class="content">xsd/hu/icellmobilsoft/project/dto/super.catalog.xml</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ezekután készen is vagyunk és XSD Catalog szerint fog történni a XSD séma felolvasás.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nyelvesítés">Nyelvesítés</h4>
<div class="paragraph">
<p>Nyelvesítés funkciója egy backend rendszerben több szemszögből hasznos, például hibakódok,
enum fordítások vagy akár dokumentumok nyelvesített generálása.
Erre a célra a deltaspike
<a href="http://deltaspike.apache.org/documentation/core.html#Messagesandi18n">Messages and i18n</a>
funkciót használja, ami még fel van javítva újabb CDI lehetőségekkel.</p>
</div>
<div class="paragraph">
<p>Három komponense van:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>nyelv megállapítása (LocaleResolver)</p>
</li>
<li>
<p>nyelvesítő fájlok</p>
</li>
<li>
<p>nyelvesítés kezelő (LocalizedMessage)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_nyelv_localeresolver">Nyelv (LocaleResolver)</h5>
<div class="paragraph">
<p>Alapból a deltaspike tartalmaz egy beépített nyelv feloldást,
ami a futó JVM locale-t adja vissza,
persze ez nem felel meg egy rendszernek,
így CDI segítségével kell <code>@Alternative</code>-ot készíteni például így:</p>
</div>
<div class="listingblock">
<div class="title">ProjectLocaleResolver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.Locale</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.Priority</span>;
<span class="keyword">import</span> <span class="include">javax.enterprise.context.Dependent</span>;
<span class="keyword">import</span> <span class="include">javax.enterprise.inject.Alternative</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.interceptor.Interceptor</span>;

<span class="keyword">import</span> <span class="include">org.apache.commons.lang3.StringUtils</span>;
<span class="keyword">import</span> <span class="include">org.apache.deltaspike.core.impl.message.DefaultLocaleResolver</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.logger.AppLogger</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.logger.ThisLogger</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.common.rest.header.ProjectHeader</span>;

<span class="annotation">@Dependent</span>
<span class="annotation">@Alternative</span>
<span class="annotation">@Priority</span>(Interceptor.Priority.APPLICATION + <span class="integer">10</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProjectLocaleResolver</span> <span class="directive">extends</span> DefaultLocaleResolver {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DEFAULT_LANGUAGE = <span class="string"><span class="delimiter">&quot;</span><span class="content">hu</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ProjectHeader header;

    <span class="annotation">@Inject</span>
    <span class="annotation">@ThisLogger</span>
    <span class="directive">private</span> AppLogger log;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Locale</span> getLocale() {
        <span class="keyword">if</span> (header != <span class="predefined-constant">null</span>) {
            log.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">header language: [{0}]</span><span class="delimiter">&quot;</span></span>, header.getLanguage());
            <span class="predefined-type">String</span> language = header.getLanguage();
            <span class="keyword">if</span> (StringUtils.isNotBlank(language)) {
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Locale</span>(language);
            }
        }
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Locale</span>(DEFAULT_LANGUAGE);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ebben az ezetben egy CDI <code>ProjectHeader</code> kezelt osztályból kérjük ki a nyelvet,
amit feltöltöttünk például a REST HTTP header adataiból.</p>
</div>
<div class="paragraph">
<p>Persze még a <code>beans.xml</code> fájlban ezt az <code>@Alternative</code>-ot aktiválni kell.</p>
</div>
</div>
<div class="sect4">
<h5 id="_nyelvesítő_fájlok">Nyelvesítő fájlok</h5>
<div class="paragraph">
<p>A nyelvesítő fájlok a rendes Java által támogatott rendeszeren működik,
tehát a
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle.html</a>
szerint.
Röviden összefoglalva ha van egy szótár fájl akkor a fájl neve + postfix halmaza adja meg a nyelvi feloldást.</p>
</div>
<div class="paragraph">
<p>A rendszer alapból a "<strong>i18n.messages</strong>" ResourceBundle nevet támogatja, példa fájl:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/i18n/messages_hu.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">pattern.date.full = yyyy-MM-dd HH:mm:ss
pattern.date = yyyy-MM-dd
pattern.time = HH:mm:ss
pattern.date.time = yyyy-MM-dd HH:mm

hu.icellmobilsoft.coffee.dto.exception.enums.CoffeeFaultType.GENERIC_EXCEPTION = Nem várt hiba történt!</code></pre>
</div>
</div>
<div class="paragraph">
<p>A fájlból látható hogy a "hu" locale-ra érvényes tartalmat gyűjti öszze.</p>
</div>
<div class="paragraph">
<p>A szótár fájlok mennyisége szabadon bővíthető a <code><strong>coffee.config.resource.bundles</strong></code> konfigurációs kulcsal,
ahol felsorolva lehet megadni többet/mást is:</p>
</div>
<div class="listingblock">
<div class="title">project-defaults.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">coffee</span>:
    <span class="key">config</span>:
        <span class="key">resource</span>:
            <span class="key">bundles</span>: <span class="string"><span class="content">i18n.messages,i18n.validations </span></span><b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>space és idézőjelek nélkül kell megadni</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Látható hogy 2 fálj csoportban van megadva a szótárázás, amelyek lehetnek például a következők:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>src/main/resources/i18n/messages.properties</p>
</li>
<li>
<p>src/main/resources/i18n/messages_en.properties</p>
</li>
<li>
<p>src/main/resources/i18n/messages_hu.properties</p>
</li>
<li>
<p>src/main/resources/i18n/validations.properties</p>
</li>
<li>
<p>src/main/resources/i18n/validations_en.properties</p>
</li>
<li>
<p>src/main/resources/i18n/validations_hu.properties</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_nyelvesítés_kezelő_localizedmessage">Nyelvesítés kezelő (LocalizedMessage)</h5>
<div class="paragraph">
<p>Teljes mértékben használható a deltaspike type-safe megoldása is,
de ez legtöbbször nem felel meg a projekteken,
ott főleg dinamikus kulcsok (pl. hibakódok) alapján kell a nyelvesített üzenetet válaszolni.</p>
</div>
<div class="paragraph">
<p>Erre a célra jött létre a <code>LocalizedMessage</code> osztály.
Tartalmaz egy pár kulcs szerinti szótar feloldást például az enumok és osztályok számára,
szabadon bővíthető, módosítható akár @Alternative-al is.
Pár minta a használatból:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.rest.locale.LocalizedMessage</span>;

...
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> LocalizedMessage localizedMessage;
...
    protected <span class="predefined-type">String</span> createDateTimePattern() {
        <span class="keyword">return</span> StringUtils.defaultString(localizedMessage.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">{pattern.date.full}</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy.MM.dd HH:mm:ss</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">protected</span> <span class="predefined-type">String</span> localizeEnum(<span class="predefined-type">Enum</span>&lt;?&gt; enumValue) {
        <span class="keyword">return</span> localizedMessage.message(enumValue);
    }

    <span class="directive">protected</span> <span class="predefined-type">String</span> getMessage(<span class="predefined-type">String</span> faultType) {
        <span class="keyword">return</span> localizedMessage.message(GeneralExceptionMapper.class, faultType);
    }
...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common_coffee-model">Coffee model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A model modulnak több almodulja lehet, melyek bizonyos célú adatbázis táblákat tartalmaznak.</p>
</div>
<div class="sect2">
<h3 id="_coffee_model_base">coffee-model-base</h3>
<div class="paragraph">
<p>Modul célja az alap táblastruktúra meghatározása.</p>
</div>
<div class="paragraph">
<p>Minden táblának tartalmaznia kell közös ID, AUDIT és VERSION oszlopokat.
Ezekre nyújt ősosztályokat, id generátort és audit mező töltőt.
Tartamazza a deltaspike DATA bekötését, mely a criteria API könnyítését segíti,
és a maven ezekre az ősökre kigenerálja a SingularAttribute osztályokat is.</p>
</div>
</div>
<div class="sect2">
<h3 id="_coffee_model_security">coffee-model-security</h3>
<div class="paragraph">
<p>Modul célja egy általános jogosultság kezelés és az ide tartozó entitások gyűjtése.</p>
</div>
<div class="paragraph">
<p>Eddigi projektekbeli különböző jogosultsági rendszerek logikája alapján össze lettek gyűjtve
az alap táblák entity osztályai. Egy projekt ezeket szabadon függetlenül használhatja,
az entity-k között ezért nincs semmiféle kapcsolat, hogy ne korlátozzuk a kombinációk lehetőségét.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common_coffee-modules">Coffee modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="common_module_coffee-module-activemq">coffee-module-activemq</h3>
<div class="paragraph">
<p>Modul célja az Apache ActiveMQ bekötése.</p>
</div>
<div class="paragraph">
<p>Tartalmaz különböző kiszolgáló osztályokat és metódusokat a JMS kezelésre</p>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-document">coffee-module-document</h3>
<div class="paragraph">
<p>Modul célja a template szövegek tárolása, kezelése. Tehát ha egy SMS, Email,
PDF vagy egyéb szöveget kell megkapni kitöltve változó paraméterekkel, különböző nyelveken,
akkor ezt ez a modul kezeli.</p>
</div>
<div class="paragraph">
<p>Tartalmaz egy általános DTO almodult (nem kötelező használni) amiben már előre meg vannak határozva
a kommunikációs objektumok. Az működési alapelv hogy inputban bejön a template kódja,
kitöltendő paraméterek kulcs-érték párosai, azt be helyettesíti a template-be,
majd válaszban vissza adja azt. Ha nem jött be minden kellő paraméter, akkor beletölti a default értékeket,
melyeket szintén tárolja a modul. A modul alkalmas fájlok mentésére is,
csak ezt korlátozottan kell használni, mert adatbázisba menti őket.</p>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-etcd">coffee-module-etcd</h3>
<div class="paragraph">
<p>Modul célja az ETCD kezelése. Működése a hivatalos</p>
</div>
<div class="listingblock">
<div class="title">maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.etcd<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jetcd-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.5.0<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>driveren alapszik, kiterjesztve céges használati modell lehetőségekkel. Pontosabb leírás külön oldalon található</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
ETCD kezelése bővebben: <a href="#howto_etcd">ETCD</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Röviden összefoglalva az ETCD-ben szereplő kulcs-érték párosok a microprofile-config-en keresztül eléhetőek, de más lehetőségek is léteznek, ajánlottak a következőek</p>
</div>
<div class="listingblock">
<div class="title">ETCD key-value</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1. ConfigurationHelper használata (ajánlott request scope cache végett)</span>
<span class="annotation">@Inject</span>
<span class="directive">private</span> ConfigurationHelper configurationHelper;
...
Integer ttl = configurationHelper.getInteger(<span class="string"><span class="delimiter">&quot;</span><span class="content">public.login.session.token.validity</span><span class="delimiter">&quot;</span></span>);


<span class="comment">// 2. ApplicationConfiguration használata (ajánlott application scope cache végett)</span>
<span class="annotation">@Inject</span>
<span class="directive">private</span> ApplicationConfiguration applicationConfiguration;
...
String minVersion = applicationConfiguration.getString(EtcdVal.KEY_PUBLIC_INVOICE_MIN_REQUEST_VERSION);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_loggolás_2">Loggolás</h4>
<div class="paragraph">
<p>A lekérdezett kulcsok és a kapott értékek logolásra kerülnek, kivéve ha a kulcs megfelel a <code>[\w\s]*?secret[\w\s]*?</code> vagy <code>[\w\s]*?pass[\w\s]*?</code> reguláris kifejezésnek, ez esetben az érték maszkolva lesz kilogolva.
Az alapértelmezett regex felülírható, ha valamelyik <strong>alapértelmezett</strong> microprofile-config forrásban (sys var, env var, META-INF/microprofile-config.properties) megadjuk a <code>coffee.config.log.sensitive.key.pattern</code> konfigot, több pattern is megadható vesszővel elválasztva.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-mongodb">coffee-module-mongodb</h3>
<div class="paragraph">
<p>A modul célja a MongoDB NOSQL adatbázis kezelésének támogatása, amihez különböző kiszolgáló osztályokat és metódusokat tartalmaz.
CDI extension kiterjesztésen alapszik <a href="http://cdi-spec.org/">cdi-spec</a>.</p>
</div>
<div class="sect3">
<h4 id="_implementálás_a_projektbe">Implementálás a projektbe</h4>
<div class="sect4">
<h5 id="_pom_xml">pom.xml</h5>
<div class="listingblock">
<div class="title">Coffee modul aktiválás</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>hu.icellmobilsoft.coffee<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>coffee-module-mongodb<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_konfiguráció_yml_ben">Konfiguráció yml-ben:</h5>
<div class="listingblock">
<div class="title">project-defaults.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">coffee</span>:
    <span class="key">mongo</span>:
        <span class="key">xmlapi</span>: #<b class="conum">(1)</b>
             <span class="key">database</span>: <span class="string"><span class="content">xmlapi</span></span>
             <span class="key">uri</span>: <span class="string"><span class="content">mongodb://sample_xmlapi:sample_xmlapi@sample-sandbox.icellmobilsoft.hu:27017/sample_xmlapi?ssl=false</span></span>
             <span class="key">connectionsPerHost</span>: <span class="string"><span class="content">150</span></span> <span class="comment">#default: 100</span>
             <span class="key">minConnectionsPerHost</span>: <span class="string"><span class="content">1</span></span> <span class="comment">#default: 1</span>
             <span class="key">connectTimeout</span>: <span class="string"><span class="content">10000</span></span> <span class="comment">#default: 10000</span>
             <span class="key">serverSelectionTimeout</span>: <span class="string"><span class="content">5000</span></span> <span class="comment">#default: 5000</span>
             <span class="key">socketTimeout</span>: <span class="string"><span class="content">0</span></span> <span class="comment">#default: 0</span>
             <span class="key">maxConnectionIdleTime</span>: <span class="string"><span class="content">20000</span></span> <span class="comment">#default: 20000</span>
             <span class="key">maxConnectionLifeTime</span>: <span class="string"><span class="content">20000</span></span> <span class="comment">#default: 20000</span>
             <span class="key">heartbeatConnectTimeout</span>: <span class="string"><span class="content">20000</span></span> <span class="comment">#default: 20000</span>
             <span class="key">heartbeatFrequency</span>: <span class="string"><span class="content">500</span></span> <span class="comment">#default: 500</span>
             <span class="key">heartbeatSocketTimeout</span>: <span class="string"><span class="content">20000</span></span> <span class="comment">#default: 20000</span>
             <span class="key">minHeartbeatFrequency</span>: <span class="string"><span class="content">500</span></span> <span class="comment">#default: 500</span>
        <span class="key">tada</span>:
            <span class="key">database</span>: <span class="string"><span class="content">tada</span></span>
            <span class="key">uri</span>: <span class="string"><span class="content">mongodb://sample_tada:sample_tada@sample-sandbox.icellmobilsoft.hu:27017</span></span>
            <span class="key">connectionsPerHost</span>: <span class="string"><span class="content">400</span></span> <span class="comment">#default: 150</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A mongoDB kapcsolat egyedi azonosítója (configKey). "database" és "uri" megadása kötelező. A többi default értékkel rendelkezik.
Paraméterek részletes leírása MongoConfigHelper osztályban található.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Több monogDB szerverhez is lehet megadni paramétereket. A configKey egyedisége határozza meg az adatbázist.</p>
</div>
</div>
<div class="sect4">
<h5 id="_használat">Használat</h5>
<div class="sect5">
<h6 id="_mongoclientconfiguration_annotáció">@MongoClientConfiguration annotáció</h6>
<div class="paragraph">
<p>Ez az annotáció lehetővé teszi hogy MongoDbClient objektumot injektáljunk. Ezen keresztül elérhető a MongoDB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@MongoClientConfiguration</span>(configKey = <span class="string"><span class="delimiter">&quot;</span><span class="content">xmlapi</span><span class="delimiter">&quot;</span></span>) #<b class="conum">(1)</b>
<span class="directive">private</span> MongoDbClient mongoDbClient;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A yml-ben meghatározott configKey érték. Egyedi azonosító.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A coff:ee mongoDB modulja le fogja gyártani a MongoDbClient objektumot, a yml-ben megadott értékeket alapul véve.
A használni kívánt collection-t külön kell megadnunk.
Ez a default MongoService implementáció ami BasicDBObject típussal képes dolgozni.</p>
</div>
<div class="listingblock">
<div class="title">Service használata</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// collection megadása</span>
mongoDbClient.initRepositoryCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">xmlapi_collection</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// a MongoUtil-ok segítéségével lehet a típusos objektumokat kezelni</span>
<span class="predefined-type">String</span> dtoJson = MongoJsonUtil.toJson(dtoDocumentType);
BasicDBObject dtoDocument = MongoUtil.jsonToBasicDbObject(dtoJson);

<span class="comment">// az elem beszúrása</span>
mongoDbClient.insertOne(dtoDocument);

<span class="comment">// a beszúrt elem id-jának lekérdezése</span>
<span class="predefined-type">String</span> id = dtoDocument.getString(MongoConstants.COLUMN_MONGO_ID);

<span class="comment">// keresés filter-el</span>
BasicDBObject filter = <span class="keyword">new</span> BasicDBObject();
filter.put(MongoConstants.COLUMN_MONGO_ID, <span class="keyword">new</span> ObjectId(mongoId));
BasicDBObject result = mongoDbClient.findFirst(filter);

<span class="comment">// keresés id-vel</span>
BasicDBObject result = mongoDbClient.findById(mongoId);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mongoserviceconfiguration_annotáció">@MongoServiceConfiguration annotáció</h6>
<div class="paragraph">
<p>Ezt az annotációt aknázza ki a CDI extension, minden osztályhoz ami kiterjeszti a MongoService&lt;T&gt; osztályt, automatikusan legenerálódik
egy @Producer ami lehetővé teszi az inject-álást.</p>
</div>
<div class="listingblock">
<div class="title">Service használata</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * MongoService kiterjesztése, POJO megadásával
 */</span>
<span class="annotation">@Dependent</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomMongoService</span> <span class="directive">extends</span> MongoService&lt;MongoEntity&gt; {
    <span class="comment">//nem szükséges semmit felülírni</span>
}

<span class="comment">/**
 * Az extension a configKey és collectionKey paraméterek alapján injectálja a CustomMongoService-t
 */</span>
<span class="annotation">@Inject</span>
<span class="annotation">@MongoServiceConfiguration</span>(configKey = <span class="string"><span class="delimiter">&quot;</span><span class="content">xmlapi</span><span class="delimiter">&quot;</span></span>, collectionKey = <span class="string"><span class="delimiter">&quot;</span><span class="content">xmlapi_collection</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> CustomMongoService customMongoService;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A CustomMongoService őse a MongoService&lt;T&gt;, ami miatt az extension feldolgozza, és a generikus paramétert figyelembe véve beállítja a háttérben
az objektumot (MongoEntity) amivel dolgozik a CustomMongoService. Az ősben lévő műveletek felülírhatóak. A CustomMongoService scope értéke is felülírható ha nem lenne megfelelő a @Dependent.
@Stateless EJB-ből használva nem működik a @Model scope, az csak a Rest interfaceken alkalmazható, ahol a http hívás végén megszűnnek az inject-ált MongoService példányok.</p>
</div>
<div class="paragraph">
<p>Használat során nem szükséges a collection-t megadni, mivel az annotációban ez megtörténik. Bármelyik MongoService használhat bármilyen collection-t, nincs megkötés.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// lekérdezés</span>
MongoEntity entity = customMongoService.findById(<span class="string"><span class="delimiter">&quot;</span><span class="content">mongoId</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// beszúrás</span>
MongoEntity mongoEntity = <span class="keyword">new</span> MongoEntity();
customMongoService.insertOne(mongoEntity);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-notification">coffee-module-notification</h3>
<div class="paragraph">
<p>Modul célja az értesítések (email, push notification,&#8230;&#8203;) központi kezelése.</p>
</div>
<div class="paragraph">
<p>A modul szorosan osszeköthető a coffee-module-document modullal, ahonnan szedi a kiküldendő üzeneteket, szövegeket.
Nemcsak a kiküldésekkel foglalkozik, hanem tárolja azt is hogy ki, kinek, mikor, mit küldött el.
Jelenleg ezeket az értesítéseket tudja kezelni:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>email</p>
</li>
<li>
<p>push notification</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tartalmaz egy általános DTO almodult (nem kötelező használni) amiben már előre megvannak határozva a
kommunikációs objektumok.</p>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-redis">coffee-module-redis</h3>
<div class="paragraph">
<p>Modul célja Redis online key-value kezelése.</p>
</div>
<div class="paragraph">
<p>A "redis.clients:jedis" java driver alapon működő modul nemcsak a Redisből való lekérdezéseket és mentéseket szolgálja ki, de tud nyújtani egy Redisben mentett cache kezelést is, ami a CDI interceptor alapjain működik.</p>
</div>
<div class="sect3">
<h4 id="_redisconnection">RedisConnection</h4>
<div class="paragraph">
<p>Bevezetésre került a <code>@RedisConnection</code> qualifier.
Ennek használatával nincs szükség Redis kapcsolatonként külön definiálni/implementálni a Redis konfigurációt, JedisPool-t, Jedis-t, RedisService -t; CDI-on keresztül mindegyik legyártásra kerül és injectelhetó.
Konfiguráció yaml-ben:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">coffee</span>:
    <span class="key">redis</span>:
        <span class="key">auth</span>: #<b class="conum">(1)</b>
            <span class="key">host</span>: <span class="string"><span class="content">sample-sandbox.icellmobilsoft.hu</span></span> <span class="comment">#default: localhost</span>
            <span class="key">port</span>: <span class="string"><span class="content">6380</span></span> <span class="comment">#default: 6380</span>
            <span class="key">password</span>: <span class="string"><span class="content">pass1234</span></span> <span class="comment">#default: null</span>
            <span class="key">database</span>: <span class="string"><span class="content">1</span></span> <span class="comment">#default: 1</span>
            <span class="key">pool</span>:
                <span class="key">maxtotal</span>: <span class="string"><span class="content">128</span></span> <span class="comment">#default: 64</span>
                <span class="key">maxidle</span>: <span class="string"><span class="content">32</span></span> <span class="comment">#default: 64</span>
            <span class="key">timeout</span>: <span class="string"><span class="content">5000</span></span> <span class="comment">#default: 5000</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A redis kapcsolat egyedi azonosítója (configKey). Minden mező opcionális.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A fenti konfig-hoz tartozó RedisService használata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@RedisConnection</span>(configKey = <span class="string"><span class="delimiter">&quot;</span><span class="content">auth</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> RedisService authRedisService;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-ruleng">coffee-module-ruleng</h3>
<div class="paragraph">
<p>A modul célja egy univerzális szabály rendszer kiértékelés támogatása.</p>
</div>
<div class="paragraph">
<p>Egyre több helyen van igény hogy egy adat halmazon több kiértékelés elvégzése szükséges,
ezeknek az eredményei szerint dől el a teljes feldolgozás kimenete. Példa használati esetek:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>beküldött számla feldolgozás</p>
<div class="ulist">
<ul>
<li>
<p>számla fejléc ellenőrzések (egyszerű adatok, külső függőség)</p>
</li>
<li>
<p>számlán lévő tételek ellenőrzése (listán kell végigszaladni)</p>
</li>
<li>
<p>számla összesítő ellenőrzések (kalkulált adatok)</p>
</li>
<li>
<p>speciális ellenőrzések (előbbiek kombinációja)</p>
</li>
</ul>
</div>
</li>
<li>
<p>bérlet, kedvezmény ellenőrzés</p>
<div class="ulist">
<ul>
<li>
<p>valós tulajdonos, érvenyesség, kibocsátó (külső függőség)</p>
</li>
<li>
<p>kedvezmény mértéke, felhasználás jogosultsága (kalkulált adatok)</p>
</li>
</ul>
</div>
</li>
<li>
<p>kölcsön kérvényezés</p>
<div class="ulist">
<ul>
<li>
<p>kérvény adatok ellenőrzése</p>
</li>
<li>
<p>felülvizsgálatok</p>
</li>
</ul>
</div>
</li>
<li>
<p>sok egyéb használati eset</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_alapelvek">Alapelvek</h4>
<div class="paragraph">
<p>Működése teljesen a CDI alapjain dolgozik, a következő igényekre öszpontosítva:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CDI elvei szerint modularizálható, szinte minden keretrendszeri működés egyénileg módosítható</p>
</li>
<li>
<p>1 szabály 1 önálló osztály</p>
</li>
<li>
<p>a szabály belső logikája a KISS (keep is simple, stupid) elvét követi</p>
</li>
<li>
<p>hagyományos korlátlan EE logika használati lehetőség</p>
</li>
<li>
<p>a szabály kiértékelése hibatűrő kell hogy legyen, null-safe, csak a saját adatára öszpontosít,
nem érdekli a más szabály kiértékelése</p>
</li>
<li>
<p>lehetőség a szabályok sorbarendezésére, csoportosítására (kiértékelés párhuzamosítására)</p>
</li>
<li>
<p>lehetőség a sorban feldolgozás megszakítására, míg a másik csoport feldolgozása független</p>
</li>
<li>
<p>kiértékelés eredménye lehet pozitív vagy negatív, logikának nem számít hogyan van használva</p>
</li>
<li>
<p>verziózott adatok szerinti szabály de/aktiválása</p>
</li>
<li>
<p>minden szabály azonos osztály típussal kell hogy végezzen</p>
</li>
<li>
<p>1 szabályon belül több kiértékelés lehetséges (kerülni kell, de néha igény)</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_rule">Rule</h4>
<div class="paragraph">
<p>Sok fajta szabály kiértékelés lehetséges, a következő minta szerint lehet kiindulni</p>
</div>
<div class="listingblock">
<div class="title">Minta szabály</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.enterprise.inject.Model</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.annotation.Range</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.cdi.annotation.Version</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.dto.exception.BaseException</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.dto.exception.TechnicalException</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.dto.exception.enums.CoffeeFaultType</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.module.ruleng.rule.IRule</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.enums.ValidatorFaultType</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.rule.RuleException</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.rule.CustomRuleResult</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.rule.DataHelper</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.annotation.Ac</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.schemas.data.LineType</span>;

<span class="annotation">@Model</span>
<span class="annotation">@Version</span>(include = <span class="annotation">@Range</span>(from = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span>)) <span class="comment">// Nem kötelező </span><b class="conum">(1)</b>
<span class="annotation">@Ac</span> <span class="comment">// Szabály kategória </span><b class="conum">(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AcExampleRule</span> <span class="directive">implements</span>
    IRule&lt;LineType, CustomRuleResult&gt;, //<b class="conum">(3)</b>
    IRuleSelector { <span class="comment">// Nem kötelező </span><b class="conum">(4)</b>

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataHelper dataHelper; //<b class="conum">(5)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> CustomRuleResult apply(LineType input) <span class="directive">throws</span> RuleException, BaseException { //<b class="conum">(6)</b>
        <span class="keyword">if</span> (input == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> TechnicalException(CoffeeFaultType.WRONG_OR_MISSING_PARAMETERS, <span class="string"><span class="delimiter">&quot;</span><span class="content">input is null</span><span class="delimiter">&quot;</span></span>);
        }

        <span class="keyword">if</span> (input.getSub() != <span class="predefined-constant">null</span> &amp;&amp; !input.getSub().getData() ! = <span class="predefined-constant">null</span> //<b class="conum">(7)</b>
            &amp;&amp; input.getSub().getData().compareTo(dataHelper.getValue()) == <span class="integer">0</span>) {
            <span class="keyword">return</span> <span class="keyword">new</span> CustomRuleResult(ValidatorFaultType.INVALID_SUB_DATA);
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>; //<b class="conum">(8)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> order() { //<b class="conum">(9)</b>
        <span class="keyword">return</span> <span class="integer">0</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Enum</span>&lt;?&gt; group() { //<b class="conum">(10)</b>
        <span class="keyword">return</span> RuleGroup.NONE;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Szabály adat verzió szerinti aktiválása - NEM KÖTELEZŐ</p>
</li>
<li>
<p>Szabály kategória. Ez egy @Qualifier típusú annotáció</p>
</li>
<li>
<p>IRule&lt;InputType, CustomRuleResult&gt; - bejövő adat típus és kimenet</p>
</li>
<li>
<p>Szabály csoportosítás és sorrendezési lehetőség - NEM KÖTELEZŐ</p>
</li>
<li>
<p>Így jöhet be az előre kalkulált adat, amit a szabály felhasznál a kiértékelésnél</p>
</li>
<li>
<p>RuleException - olyan esetben dobunk amikor megszakítás kell a szabály kiértékelésben</p>
</li>
<li>
<p>null-safe ellenőrzések</p>
</li>
<li>
<p>Igény esetén pozitív kiertékelés is adhat vissza eredményt</p>
</li>
<li>
<p>Szabály sorrendje, alapból 0</p>
</li>
<li>
<p>Szabály csoport, alapból NONE</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Hogy is működik:</div>
<ul>
<li>
<p>Az AcExampleRule olyan adatra fog aktiválódni, melynek a verziószáma 1.1+.
Ezt a <code>hu.icellmobilsoft.coffee.tool.version.ComparableVersion</code> osztály szerint állapítja meg.</p>
<div class="ulist">
<ul>
<li>
<p>Lehetőség van megadni különböző verzió intervallumokat</p>
</li>
</ul>
</div>
</li>
<li>
<p>Az AcExampleRule egy "Ac" kategóriába tartozó  szabály, melynek a bemenet LineType (akármi lehet)
és CustomRuleResult (<code>extends hu.icellmobilsoft.coffee.module.ruleng.rule.RuleResult</code>) a kiértékelése</p>
</li>
<li>
<p>Jelenleg használja a IRuleSelector-t is, ami nem kötelező.
Az implementált metódusai az alapértlmezett értékeket használják a példában. Hogyha több szabályunk van
ugyanarra a kategória és implementáció kombinációra a rendszer ezek szerint fogja csoportosítani, végrehajtani őket</p>
<div class="ulist">
<ul>
<li>
<p>order() - növekvő sorrendben fogja a kiértékelést alkalmazni.</p>
</li>
<li>
<p>group() - szabály csoportja. Hogyha a csoportban valamelyik szabály RuleException-el szál el,
akkor az order szerinti utánna lévő szabályok nem fognak lefutni. Másik csoportot a megszakítás nem érinti,
egymástól a csoportok függetlenek</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Ha a szabályra nem rakjuk IRuleSelector interfészt, akkor a szabályok alapból a Class.SimpleName szerint fognak lefutni,
és RuleGroup.NONE csoportba fog tartozni
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Ellenőrizzük az input adatot, csak arra koncentrálunk hogy létezik-e az az adat amit ellenőrizni kell</p>
</li>
<li>
<p>Az adatot kiértékeljük és a szabály szerepe itt véget ér</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A kiértékelési CustomRuleResult projekt igényeire szabható, feltétel hogy a <code>hu.icellmobilsoft.coffee.module.ruleng.rule.RuleResult</code> legyen az őse
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_validator">Validator</h4>
<div class="paragraph">
<p>Célja lekezelni a szabály-kategóriába tartozó szabályokat.</p>
</div>
<div class="listingblock">
<div class="title">Minta validátor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.lang.annotation.Annotation</span>;

<span class="keyword">import</span> <span class="include">javax.enterprise.inject.Model</span>;
<span class="keyword">import</span> <span class="include">javax.enterprise.util.TypeLiteral</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.module.ruleng.rule.IRule</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.module.ruleng.evaluator.AbstractEvaluator</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.project.schemas.data.LineType</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.sample.common.system.validator.rule.CustomRuleResult</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.sample.invoice.common.action.evaluator.annotation.Ac</span>;

<span class="annotation">@Model</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ACEvaluatorLineType</span> <span class="directive">extends</span> AbstractEvaluator&lt;LineType, CustomRuleResult&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Annotation</span> cdiSelectLiteral() {
        <span class="keyword">return</span> <span class="keyword">new</span> Ac.Literal(); //<b class="conum">(1)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> TypeLiteral&lt;IRule&lt;LineType, CustomRuleResult&gt;&gt; cdiTypeLiteral() {
        <span class="keyword">return</span> <span class="keyword">new</span> TypeLiteral&lt;IRule&lt;LineType, CustomRuleResult&gt;&gt;() { <b class="conum">(2)</b>
            <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        };
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Szabály kategória Qualifier annotáció</p>
</li>
<li>
<p>IRule&lt;LineType, CustomRuleResult&gt; implemetációval ellátott szabályok típusú CDI literal</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Hogy is működik:</div>
<ul>
<li>
<p>A validátorból szintén több létezhet, minden egyes szabály kategória és implementációra kell saját.</p>
</li>
<li>
<p>Első dolga hogy beolvassa a CDI konténerből az általa kezelt kategória és implementáció szabályokat</p>
<div class="ulist">
<ul>
<li>
<p>Megpróbálja csoportosítani az említett IRuleSelector szerint majd sorba rendezi őket order majd class neve szerint</p>
</li>
</ul>
</div>
</li>
<li>
<p>Végigfut a kategorizált szabályokon, gyűjti az eredményeket</p>
</li>
<li>
<p>Válaszban visszaadja a lefutott összes szabály eredményét</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-mp-restclient">coffee-module-mp-restclient</h3>
<div class="paragraph">
<p>A modul célja a microprofile restclient támogatása mely tartalmazza a következő alapelveket:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Coffee kompatibilizás - eredeti request headerek másolása, log MDC kulcsok tovább adása, Exception kezelés</p>
</li>
<li>
<p>Üzleti folyamat követhetősége - request/response loggolás</p>
</li>
<li>
<p>HTTP kommunikáció személyre szabás - belső/külső HTTP kommunikáció módosíthátóság (pl. a servicek között
más REST http kell mint mondjuk amikor a XY felé küldünk requestet, mások a headerek,
tartalom, content-type stb..), TLS kulcsozás, URL és viselkedés (timeout, repeat, stb&#8230;&#8203;) felülírás</p>
</li>
<li>
<p>Exception személyre szabás - lokálisan módosítható hibakelés</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_microprofile_rest_client">microprofile-rest-client</h4>
<div class="paragraph">
<p>Kiinduló pontnak a <a href="https://github.com/eclipse/microprofile-rest-client">microprofile-rest-client</a>
van felhasználva mely a <a href="https://microprofile.io/">micropfile.io</a> csoport tagja. Ez sokmindent
levesz a válunkról, akár önmagában is használható de a projektek igényeihez még ki kell egészíteni
pár hasznos funkcióval.</p>
</div>
</div>
<div class="sect3">
<h4 id="_core">Core</h4>
<div class="paragraph">
<p>A fenti alapelvek nagy részét maga a <a href="https://github.com/eclipse/microprofile-rest-client">microprofile-rest-client</a>
biztosítja a többit a következő pár osztály végzi.</p>
</div>
<div class="sect4">
<h5 id="_defaultloggerclientrequestfilter">DefaultLoggerClientRequestFilter</h5>
<div class="paragraph">
<p>Ez egy alapértelmezett REST kliens <strong>REQUEST logger</strong>,
ami figyelembe veszi ha van megadva <code>LogSpecifier</code> <code>CLIENT_REQUEST</code> target-tel (<a href="#common_core_coffee-rest_LogSpecifier">LogSpecifier</a>).
Tehát kiloggolja a kliens átlal kiküldött HTTP <strong>request</strong> adatait:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP method, URL cím</p>
</li>
<li>
<p>HTTP headers</p>
</li>
<li>
<p>Cookies</p>
</li>
<li>
<p>Entity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ezt mind beküldi a loggerbe INFO szinten.</p>
</div>
</div>
<div class="sect4">
<h5 id="_defaultloggerclientresponsefilter">DefaultLoggerClientResponseFilter</h5>
<div class="paragraph">
<p>Ez egy alapértelmezett REST kliens <strong>RESPONSE logger</strong>,
ami figyelembe veszi ha van megadva <code>LogSpecifier</code> <code>CLIENT_RESPONSE</code> target-tel (<a href="#common_core_coffee-rest_LogSpecifier">LogSpecifier</a>).
Tehát kiloggolja a kliens átlal kiküldött HTTP <strong>request válasz</strong> adatait:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP status + kiegészítők</p>
</li>
<li>
<p>HTTP headers</p>
</li>
<li>
<p>Cookies</p>
</li>
<li>
<p>locale, location értékek</p>
</li>
<li>
<p>Entity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ezt mind beküldi a loggerbe INFO szinten</p>
</div>
</div>
<div class="sect4">
<h5 id="_defaultsettingclientrequestfilter">DefaultSettingClientRequestFilter</h5>
<div class="paragraph">
<p>Ez egy alapértelmezett REST kliens "REST setting copy".
A a feladata a <strong>szerviceken keresztül</strong> összekötni a REST hívást,
hogy például a loggolás és az <strong>authentikáció</strong> alapjai tudjanak működni.</p>
</div>
<div class="paragraph">
<p>Más szóval ha a service-be bejön egy REST request,
feldolgozás során a microservice-ben szükség egy másik microserviceben áthívni,
akkor abban a HTTP hívásban ugyan úgy szükséges belerakni azokat a HTTP headereket,
melyek az service requestjében bejöttek, hogy az ottani authentikáció is sikeres lehessen.
Konkrétan az autentikáció MDC változók beállítása bekerül a kiküldött http headerek közé.</p>
</div>
</div>
<div class="sect4">
<h5 id="common_module_coffee-module-mp-restclient_DefaultRestClientBuilderListener">DefaultRestClientBuilderListener</h5>
<div class="paragraph">
<p>Ez egy <strong>minta "aktivátor" a fenti felsorolt osztályok bekötésére</strong>.
Jelenleg még ezt az osztályt minden projekt kell hogy implementálja és kiegészítse exception kezeléssel,
mivel az még nem emelhető ki Coffee-be (catalog XSD implementálása funkció után már igen - tervben van).
Ezen kívül az osztályban van definiálva a HTTP kliens timeout értékei is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>5 sec connect timeout</p>
</li>
<li>
<p>1 perc read timeout</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ha van bármilyen működési változtatási igény,
akkor azt ezen a központi "aktivátor" osztályon keresztül is lehet befolyásolni,
további lehetőségek lejebb vannak említve,
ami a <a href="https://github.com/eclipse/microprofile-rest-client">microprofile-rest-client</a> szabályai szerint történnek.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementálás_a_projektbe_2">Implementálás a projektbe</h4>
<div class="sect4">
<h5 id="_pom_xml_2">pom.xml</h5>
<div class="listingblock">
<div class="title">Coffee modul aktiválás</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>hu.icellmobilsoft.coffee.module.mp.restclient<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>coffee-module-mp-restclient<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ez mellett kellhet aktiválni az alkalmazás szerver kiterjesztését is,
ami például a thorntail serverben a következő:</p>
</div>
<div class="listingblock">
<div class="title">Thorntail alkalmazás szerver aktiválás</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.thorntail<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>microprofile-restclient<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_microprofile_rest_client_regisztráció">microprofile-rest-client regisztráció</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Jelenleg még nincs elkészítve egy default exception lekezelő osztály,
ezért mintaként szolgáljon valamelyik projektünkben már elkészített
'DefaultBaseExceptionResponseExceptionMapper' osztály.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hogy az "aktivátor" figyelembe is legyen véve a
<a href="https://github.com/eclipse/microprofile-rest-client">microprofile-rest-client</a>
számára <strong>a DefaultRestClientBuilderListener osztályt projekt szinten le kell örököltetni</strong>
és az exception kezelést is beallítani. Az így keletkező osztályt a következő fájlban kell regisztrálni:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/services/org.eclipse.microprofile.rest.client.spi.RestClientBuilderListener</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">hu.icellmobilsoft.sample.invoice.service.provider.ProjectRestClientBuilderListener</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ez egy sima postfix és extension nélküli txt fájl.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_használati_példák">Használati példák</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Maga a komplett használat részletes leírása a
<a href="https://github.com/eclipse/microprofile-rest-client">microprofile-rest-client</a>
relese kiadásaiban tálálható. Itt helyben pár mintát fogunk említeni.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_minta_használati_lehetőség">Minta használati lehetőség</h5>
<div class="sect5">
<h6 id="_inicializálás">Inicializálás</h6>
<div class="paragraph">
<p>Abban az osztályban ahol a REST operációkat definiáljuk
(ha követjük a céges ajánlott REST struktúrát akkor ez a REST interface) ki kell egészíteni a
@RegisterRestClient annotációval.
Ezzel tulajdonképpen megmondjuk a microprofile-rest-client rendszernek
hogy az ebben definiált REST végpontokra HTTP REST kliensként is lehessen hivatkozni.
Maga kliensben így felfogja tudni használni az itt használt típusokat, annotációkat beállításokat,
leesik a teher ezeknek a külön beállításaira (pl. text/xml, application/json, entity class, stb&#8230;&#8203;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Tag</span>(name = IInvoiceTestRest.TAG_TEST, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Számlafeldolgozóhoz szükséges SYSTEM REST teszt operációk</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Path</span>(InvoicePath.TEST_INVOICE_SERVICE)
<span class="annotation">@RegisterRestClient</span> // <b class="conum">(1)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">IInvoiceTestRest</span> {

    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TAG_TEST = <span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>;
    ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>hozzá rakjuk a @RegisterRestClient annotációt.
Általában más már nem kell (hacsak nincsenek valami spéci igények), régi működést nem befolyásolja</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_http_kliens_használata">HTTP kliens használata</h6>
<div class="paragraph">
<p>A kódban a HTTP REST kliens leghasználtabb esetei:</p>
</div>
<div class="listingblock">
<div class="title">CDI inject</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.enterprise.inject.Model</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.inject.RestClient</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.dto.exception.BaseException</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.module.mp.restclient.util.MPRestClienUtil</span>;

<span class="annotation">@Model</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestAction</span> {

    <span class="annotation">@Inject</span>
    <span class="annotation">@RestClient</span> // <b class="conum">(1)</b>
    <span class="directive">private</span> IInvoiceTestRest iInvoiceTestRest; // <b class="conum">(2)</b>

    <span class="directive">public</span> <span class="predefined-type">String</span> test() <span class="directive">throws</span> BaseException {
        <span class="keyword">try</span> {
            iInvoiceTestRest.postValidatorTest(entityClass); // <b class="conum">(3)</b>
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) { // <b class="conum">(4)</b>
            <span class="keyword">throw</span> MPRestClientUtil.toBaseException(e); // <b class="conum">(5)</b>
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>mp-rest-client @Qualifier annotáció mely a HTTP kliens wrappert hoz létre</p>
</li>
<li>
<p>interface melyet megjelöltünk a @RegisterRestClient annotációval</p>
</li>
<li>
<p>HTTP REST kliens hívása - ebben a pontban lépnek majd szerepre a konfigurációs beállítasok (URL, HTTP header, timeout, stb&#8230;&#8203;)</p>
</li>
<li>
<p>általános hbakezelés. Maga az operáción ugye BaseException van definiálva de az service szintre értendő,
mi most kliensként használjuk és a &lt;1&gt; pontál mi ezt beburkoltuk egy wrapperbe,
mely más RuntimeException hibákkal térhet vissza</p>
</li>
<li>
<p>Coffee szinten előre megírt Exception fordító</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Valószinű az egészre még létrejön egy boilerplate wrapper mely még jobban leegyszerűsíti a kódolást.</p>
</div>
<div class="listingblock">
<div class="title">Inline</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.net.URI</span>;

<span class="keyword">import</span> <span class="include">javax.enterprise.inject.Model</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="keyword">import</span> <span class="include">org.eclipse.microprofile.rest.client.RestClientBuilder</span>;

<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.dto.exception.BaseException</span>;
<span class="keyword">import</span> <span class="include">hu.icellmobilsoft.coffee.module.mp.restclient.util.MPRestClienUtil</span>;

<span class="annotation">@Model</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestAction</span> {

    <span class="directive">public</span> <span class="predefined-type">String</span> doWorkAgainstApi(<span class="predefined-type">URI</span> uri, <span class="predefined-type">Object</span> entity) {
        <span class="keyword">try</span> {
            IInvoiceTestRest iInvoiceTestRest = RestClientBuilder <span class="comment">//</span>
                    .newBuilder() // <b class="conum">(1)</b>
                    .baseUri(uri) // <b class="conum">(2)</b>
                    .build(IInvoiceTestRest.class); <b class="conum">(3)</b>
            <span class="keyword">return</span> iInvoiceTestRest.postValidatorTest(entity);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) { // <b class="conum">(4)</b>
            <span class="keyword">throw</span> MPRestClientUtil.toBaseException(e); // <b class="conum">(5)</b>
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>itt meghívódik a <a href="#common_module_coffee-module-mp-restclient_DefaultRestClientBuilderListener">DefaultRestClientBuilderListener</a>,
melynek bármilyen beállítását felül lehet írni.</p>
</li>
<li>
<p>felülírjuk a konfigokban definiált URI-t</p>
</li>
<li>
<p>interface melyet megjelöltünk a @RegisterRestClient annotációval</p>
</li>
<li>
<p>általános hibakezelés. Maga az operáción ugye BaseException van definiálva de a builder ezt beburkolta egy wrapperbe,
mely más RuntimeException hibákkal térhet vissza</p>
</li>
<li>
<p>Coffee-ben előre megírt Exception fordító</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ezt a használatot nagyon egyedi esetben használjuk,
hacsak lehet törekedjünk a CDI és konfiguráció szintű megoldásra.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_konfigurációs_lehetőségek">Konfigurációs lehetőségek</h5>
<div class="paragraph">
<p>A konfigurációkat meg lehet adni egyben az annotációkkal is,
de természetesen a microprofile-config lehetőségei adottak most is.
Továbbá pár leggyakoribb konfigurációs mintát sorolnék fel.
Maga szintaxis a kovetkező:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">kategoria-kulcs-nev/mp-rest/kulcs

vagy

full-class-name/mp-rest/kulcs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahol a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>kategoria-kulcs-nev</strong> - kulcsszó melyet választunk a kódunkban
és a <code>@RegisterRestClient(configKey="invoiceService")</code> annotációban felhasználunk,
ami az esetünkben például az "invoiceService"</p>
</li>
<li>
<p><strong>full-class-name</strong> - osztály (esetünkben inkább interface) neve,
ahol a @RegisterRestClient annotáció fel van rakva. Lehetőség szerint <strong>ezt a fajta konfigurációt kerüljük</strong>,
mivel későbbi refaktorálás rejtett hibákat okozhat a konfigokban</p>
</li>
<li>
<p><strong>/mp-rest</strong> - microprofile-rest-client default kulcsszó</p>
</li>
<li>
<p><strong>/kulcs</strong> - maga a microprofile-rest-client által támogatott kulcs, pl.: url, providers, readTimeout, stb&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">project-default.yml - minta konfiguráció</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key"><span class="delimiter">&quot;</span><span class="content">invoiceService/mp-rest/url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">http://localhost:8083</span></span>
<span class="key"><span class="delimiter">&quot;</span><span class="content">invoiceService/mp-rest/providers</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">hu.icellmobilsoft.project.invoice.CustomProvider</span></span>

<span class="comment">#vagy a másik lehetóség</span>

<span class="key"><span class="delimiter">&quot;</span><span class="content">hu.icellmobilsoft.project.invoice.service.rest.IInvoiceTestRest/mp-rest/url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">http://localhost:8083</span></span>
<span class="key"><span class="delimiter">&quot;</span><span class="content">hu.icellmobilsoft.project.invoice.service.rest.IInvoiceTestRest/mp-rest/providers</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">hu.icellmobilsoft.project.invoice.CustomProvider</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common_module_coffee-module-totp">coffee-module-totp</h3>
<div class="paragraph">
<p>A modul célja az időalapú egyszer használható jelszavak (Time-based one-time password - TOTP) szabvány szerinti létrehozása, ellenőrzése.
A 6238-as számú RFC-ben leírt algoritmust implementáltuk, kiegészítve az általunk is használt microprofile-configgal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Az rfc-6238-ban szereplő algoritmus
<a href="https://tools.ietf.org/html/rfc6238" class="bare">https://tools.ietf.org/html/rfc6238</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_implementálás_a_projektbe_3">Implementálás a projektbe</h4>
<div class="sect4">
<h5 id="_pom_xml_3">pom.xml</h5>
<div class="listingblock">
<div class="title">Coffee modul aktiválás</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>hu.icellmobilsoft.coffee.module.totp<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>coffee-module-totp<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Az 1. táblázatban megtalálhatóak a modul által használt konfigurációs kulcsok.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Konfigurációs paraméterek</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">paraméter neve</th>
<th class="tableblock halign-left valign-top">default érték</th>
<th class="tableblock halign-left valign-top">leírás</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">totp.password.digits.length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ilyen hosszú jelszót generál a metódusunk (max. 9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">totp.password.timestep.millisec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Az aktuálisan generált jelszóhoz tartozó időablak hossza ezredmásodpercben</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">totp.password.hash.algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HmacSha1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A jelszógeneráláshoz ezt a hash algoritmust használja</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">totp.password.secret.length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ilyen hosszú secretet generálunk/használunk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">totp.verify.additional.windows.count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ennek a paraméternek segítségével a jelszó ellenőrzését szomszédos időablakokra is kiterjeszthetjük</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A default értékeket úgy állítottuk be, hogy a google authenticatorral megegyező otp-t generáljon a modul, de természetesen ettől el is lehet térni.</p>
</div>
<div class="ulist">
<div class="title">A fontosabb metódusok</div>
<ul>
<li>
<p>TOTPVerifier.verify</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ennek segítségével tudjuk a kapott OTP-t validálni akár további időablakokra is kiterjesztve az érvényesség vizsgálatát.
Paraméterben megadhatjuk az ellenőrzéshez szükséges összes adatot, de használhatjuk az overloados metódusokat is, ahol a konfigurációban eltárolt/default értékeket vesszük alapul.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TOTPGenerator.generateBase32Secret</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ezzel tudunk egy (közös) secretet generálni a felhasználó számára, alapértelmezetten 16 byte hosszan. A kívánt hossz átadható paraméterként is.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TOTPGenerator.generatePassword</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ha szükségünk lenne egy OTP-re, akkor a generatePassword metódust használhatjuk ehhez, szintén megadva a generáláshoz szükséges összes paramétert, vagy a konfigurációban beállított/default értékeket alapul véve.</p>
</div>
<div class="listingblock">
<div class="title">Használata:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> TOTPVerifier totpVerifier;
<span class="annotation">@Inject</span>
<span class="directive">private</span> TOTPGenerator totpGenerator;

<span class="comment">//secretKey generálás, opcionálisan meg lehet adni paraméterben, hogy milyen hosszú legyen a secret, de általában megfelelő a 16</span>
<span class="predefined-type">String</span> secretKeyBase32Encoded1 = totpGenerator.generateBase32Secret();
<span class="predefined-type">String</span> secretKeyBase32Encoded2 = totpGenerator.generateBase32Secret(<span class="integer">32</span>);

<span class="comment">//kapott jelszó ellenőrzése</span>
<span class="comment">//rossz jelszó esetén TechnicalExceptiont dob CoffeeFaultType.INVALID_ONE_TIME_PASSWORD hibakóddal</span>
totpVerifier.verify(secretKey, clientOtp, currentUTCTimestamp, codeDigits, hashAlgorithm);
<span class="comment">//ha default konfigurációt használnánk, akkor hivhatjuk a kevesebb paraméterrel rendelkező metódusokat is</span>
totpVerifier.verify(secret, clientOtp);
totpVerifier.verify(secret, clientOtp, currentUTCTimestamp);


<span class="comment">//totp generálás</span>
<span class="comment">//az alábbi metódusok kimenete a generált jelszó</span>
<span class="predefined-type">String</span> otp1 = totpGenerator.generatePassword(secret, currentUTCTimestamp, digits, TOtpAlgorithm);
<span class="comment">//ha default konfigurációt használnánk, akkor hivhatjuk a kevesebb paraméterrel rendelkező metódusokat is</span>
<span class="predefined-type">String</span> otp2 = totpGenerator.generatePassword(secret);
<span class="predefined-type">String</span> otp3 = totpGenerator.generatePassword(secret, currentUTCTimestamp);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Érdemes a projekt szinten perzisztálni az utoljára validált és elfogadott OTP-t, hogy ne lehessen mégegyszer megadni.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Coffee implementál egy default TOTPGenerator (DefaultTOTPGneratorImpl) és egy TOTPVerifier (DefaultTOTPVerifierImpl) osztályt, amit igény szerint a projekten CDI használatával felülírhatunk.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-08-17 07:34:14 UTC
</div>
</div>
</body>
</html>